<div class="container" role="main">
  <div>Welcome: <%= current_user.name %></div>

  <h1>Reserva de Sala</h1>

  <table class="table table-striped">
    <thead>
      <th><%= t('.time') %></th>
      <% (1..5).each do |wday| %>
        <%= content_tag :th, t('date.day_names')[wday] %>
      <% end %>
    </thead>

    <tbody>
      <% (6..23).each do |hour| %>
        <tr>
          <%= content_tag :td, "%02d:00" % hour %>

          <% (1..5).each do |wday| %>
            <% schedule = Schedule.by_day(
              Schedule.new.beginning_of_week + (wday - 1)).
              by_hour(hour) %>

            <% if schedule.any? %>
              <%= content_tag :td, link_to("Reservado por #{schedule.first. user.name}", '#')  %>
            <% else %>
              <%= content_tag :td, link_to("DisponÃ­vel", '#'),
                class: "wday-#{wday} hour-#{hour}",
                onclick: 'reserve(this)',
                data: { wday: wday, hour: hour } %>
            <% end %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <script>
  function reserve(li) {
    $.post('/scheduler', $(li).data(), function(json) {
      $(li).find('a').html(json.message);
    }, 'json');
  }
  </script>
</div>